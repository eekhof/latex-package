%%% Preamble (See https://www.overleaf.com/learn/latex/Writing_your_own_package): %%%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{eekhof}[2023/01/03 Eekhof Package]

\RequirePackage{etoolbox} % For boolean definitions and conditionals, used in options and config
\RequirePackage{xparse} % For bracket definitions in \ld
\newbool{domaketitle}

%%% Config: $$$
\newcommand{\userfirstname}{Max}
\newcommand{\usersurname}{Mustermann}
\newcommand{\usernumber}{4815162}
\booltrue{domaketitle}

%%% Package imports: %%%
\RequirePackage[utf8]{inputenc}
\RequirePackage[english, german]{babel} % For umlauts etc.
\RequirePackage{ftnxtra} % For footnotes in captions
\RequirePackage[table]{xcolor} % For colored formular names etc.
\RequirePackage{mathtools} % For underbrace stretching
\usepackage{siunitx} % For \si, \num and \SI
\let\svqty\qty % To avoid conflict with \qty from \siunitx and \physics , see https://tex.stackexchange.com/questions/628183/how-to-avoid-qty-conflict-with-physics-and-siunitx
\usepackage{physics} % For dv pdv
\let\qty\svqty % To avoid conflict with \qty from \siunitx and \physics , see https://tex.stackexchange.com/questions/628183/how-to-avoid-qty-conflict-with-physics-and-siunitx
\RequirePackage{braket} % For Bra-Ket notation
\RequirePackage[T1]{fontenc} % For fonts in western European encoding (see https://texwelt.de/fragen/5537/was-macht-eigentlich-usepackaget1fontenc) ATTENTION: May cause blurry and unsharp letters (see https://tex.stackexchange.com/questions/172079/t1-encoding-causing-bad-pdf-quality), to counteract this install package 'cm-super', or do the following lmodern import, see below:
\usepackage{lmodern} % To counteract blurry font, see above
\RequirePackage{tikz-cd} % For diagrams
\RequirePackage{graphicx} % For including images
\RequirePackage{biblatex} % For bibliography
\RequirePackage{amssymb} % For special math symbols
\RequirePackage{amsmath} % For equation typesetting
\RequirePackage{multicol} % For cheatsheet columns and for tables from tablesgenerator
\RequirePackage{multirow} % For tables from tablesgenerator
\RequirePackage{booktabs} % For tables from tablesgenerator
\RequirePackage{placeins} % For FloatBarrier
\RequirePackage[parfill]{parskip} % To prevent indents after linebreaks and figures
\usepackage{enumitem} % For custom enumeration symbols
\RequirePackage{hyperref} % For hyperlinks, functioning table of contents, etc.

%%% Further setup: %%%
\sisetup{round-mode = places, round-precision = 3, locale = DE, scientific-notation = false, separate-uncertainty = true, per-mode=fraction}
\graphicspath{{assets/}}
\title{\jobname}
\author{\userfirstname{} \usersurname}
\date{}

%%%%% Import-option specific-options: %%%%%

\newbool{normalbool}
\booltrue{normalbool}
\newbool{cheatsheetbool}
\boolfalse{cheatsheetbool}
\newbool{graybool}
\boolfalse{graybool}

\DeclareOption{cheatsheet}{\booltrue{cheatsheetbool}\boolfalse{normalbool}}
\DeclareOption{gray}{\booltrue{graybool}\boolfalse{normalbool}}

\ProcessOptions\relax % ATTENTION: Alway has to be called after declareoptions

%%% Only for non-Cheatsheets (But alsoleft as default):
% Um genaue Seitenzahlen bei Zitation in PDF auszublenden, aber damit sie zum nachlesen im TEX-Dokument weiter verbleiben koennen (Quelle f端r Umdefinition: https://tex.stackexchange.com/questions/537678/how-to-renewcommand-with-2-arguments):
\ifbool{normalbool}{
	\ifbool{domaketitle}{\AtBeginDocument{\maketitle}}
	
	% Um genaue Seitenzahlen bei Zitationn in PDF auszublenden, aber damit sie zum nachlesen im TEX-Dokument weiter verbleiben koennen (Quelle fuer Umdefinition: https://tex.stackexchange.com/questions/537678/how-to-renewcommand-with-2-arguments):
	\let\oldcite\cite
	\renewcommand{\cite}[2][]{\oldcite{#2}}
	
	\patchcmd{\thebibliography}{\section*{\refname}}{}{}{} % Prevent numbering of bibliography
}
{}


%%% Only for Cheatsheets: %%%
\ifbool{cheatsheetbool}{
	\usepackage[landscape, margin=0.5cm, rmargin=0cm]{geometry} % For horizontal page and small margins
	\usepackage[compact]{titlesec} %Tighter space betwen section headers, see https://robjhyndman.com/hyndsight/squeezing-space-with-latex/
	% Set arial font (Klarer, aber etwas kleiner als oben):
	%\renewcommand{\familydefault}{\sfdefault}
	\usepackage[nosf]{kpfonts}
	\usepackage[t1]{sourcesanspro} % ATTENTION: Causes errors related to mathaccents
	%remove spacing between headers
	\titlespacing*{\section}{0pt}{0pt}{0pt}
	\titlespacing*{\subsection}{0pt}{0pt}{0pt}
	
	\newcommand{\heading}[2]{\text{\Large #1}\\- Dozent #2 - (\usersurname , \usernumber)} % Define standard header with lecture name and professor name
	\newcommand{\fm}[2]{\textcolor{blue}{#1:}\\ \textit{#2}\\} %Define "formular" command
	\newcommand{\s}[1]{\section*{\textcolor{red}{#1}}} %Define "section" command
	\renewcommand{\ss}[1]{\subsection*{\textcolor{orange}{#1}}} %Define "subsection" command, overwriting \ss for "Scharfes S"
	
	\AtBeginDocument{\begin{multicols*}{4}\begin{flushleft}}
	\AtEndDocument{\end{flushleft}\end{multicols*}}
}
{}


%%% Gray mode (Zum leichteren Abpausen von cheatsheets etc.): %%%
\ifbool{graybool}{
	\usepackage{xcolor}
	\color{gray}
}
{}


%%% Only for beamer: %%%
%TODO


%%% Math operators with self adjusting braces command \trigbraces (stolen from physics-package): %%%
\DeclareDocumentCommand\trigbraces{ m o d() }
{\IfNoValueTF{#3}
	{#1 \IfNoValueTF{#2}{}{[#2]}}
	{#1 \IfNoValueTF{#2}{}{^{#2}} \argopen(#3\argclose)}}

% Define \ld command:
\DeclareMathOperator{\logdual}{ld} % \ld does not normally exist
\DeclareDocumentCommand\ld{}{\trigbraces{\logdual}}


%%%%% Custom commands: %%%%%
% More compact german quote command:
\renewcommand{\lq}{\glqq} % ATTENTION: Overwrites \lq, which is for non-german single quotes
\renewcommand{\rq}{\grqq} % ATTENTION: Overwrites \rq, which is for non-german single quotes
% Easier integration variable (e. g. \text{d}x -> \d x):
\renewcommand{\d}{\text{d}} % ATTENTION: Overwrites \d , not clear what it normally does

\newcommand{\const}{\text{const.}} % For compact const.
% Prettier greek letters:
\let\oldphi\phi \let\phi\varphi \let\varphi\oldphi
\let\oldepsilon\epsilon \let\epsilon\varepsilon \let\varepsilon\oldepsilon

\newcommand{\f}[2]{{#1}_{\left(#2\right)}} % Command for function with argument in index
\newcommand{\bracfrac}[2]{\left(\frac{#1}{#2}\right)}

% Define more compact commands for left and right braces:
\renewcommand{\l}{\left} % ATTENTION! Overwrites command \l for small letter L with strikethrough (e. g. polish letter)
\renewcommand{\r}{\right} % ATTENTION! Overwrites ring command \r , that oversets a ring oder a letter (Such as over the A in in Angstroem)

% Nabla vector redefinition:
\let\nablanovec\nabla % Add definition for nabla without vector so that renewing of nabla with vector works
\renewcommand{\nabla}{{\vec{\nablanovec}}} % Add vector arrow to every nabla

% Enumerate symbols with brackets instead of dots:
\setenumerate[1]{label={\arabic*)}}
\setenumerate[2]{label={\alph*)}}
\setenumerate[3]{label={\roman*)}}
\setenumerate[4]{label={\Alph*)}}

% Compact includegraphic command definition:
\newcommand{\graphic}[2]{\begin{figure}[ht!]
	\centering
	\includegraphics[width = \linewidth]{#1}
	\caption{#2}
	\label{fig:#1}
\end{figure}
\FloatBarrier}

% Custom SI package stuff:
\DeclareSIUnit\clight{\text{\ensuremath{c}}}
\DeclareSIUnit\elementarycharge{e} % Without this, there is a warning that says that elementarycharge unit is deprecated

% Create gitignore if git does exist, but gitignore does not yet exist (For file check see https://tex.stackexchange.com/questions/98203/can-i-test-if-a-file-exists or https://latex.org/forum/viewtopic.php?p=5047#p5047 and for file creation see https://latex.org/forum/viewtopic.php?t=5177)
\AfterPreamble{\IfFileExists{.git}{\IfFileExists{.gitignore}{}{
	\newwrite\mywrite
	\edef\mywritename{.gitignore}
	\immediate\openout\mywrite\mywritename
	\immediate\write\mywrite{*.aux^^J*.fdb_latexmk^^J*.fls^^J*.log^^J*.out^^J*.synctex.gz^^J*.toc^^J*.bbl^^J*.bcf^^J*.run.xml}
}}{}}


% CWL:
% For proper Autocompletion write .cwl file for package according to [StackExchangeCWL](https://tex.stackexchange.com/questions/534403/how-to-format-custom-cwl-for-texstudio-completion)
% See [CWLInformation](https://htmlpreview.github.io/?https://github.com/texstudio-org/texstudio/master/utilities/manual/usermanual_en.html#description-of-the-cwl-format) for format specification
% See [CWLExampleSiUnitx](https://github.com/texstudio-org/texstudio/blob/master/completion/siunitx.cwl) for example file
% To enable intellisense autocompletion/suggestion for installed packages and homemade packages in LatexWorkshop for VSCode, follow guide on [LatexWorkshopWiki](https://github.com/James-Yu/LaTeX-Workshop/wiki/Intellisense#commands-starting-with-)


%TODO :
% Documentclass mit etoolbox-hook automatisch auf article/beamer setzen, je nach Einstellung beim Import des packages?
% Bei Mathekommandos fehlt noch Basis fuer Logarithmus durch [-2] o. ae.
% Eventuell \usepackage{listings} fuer python code einfuegen (Siehe Stellar Cookbook Rport)?
% \qty befehl f端hrt immer noch zu Problemen auf Windows und Overleaf
% Schoenere Wurzel (Mit Haken hintendran) einfuegen (Siehe https://tex.stackexchange.com/questions/29834/closed-square-root-symbol)
% Vernuenftige Bibtex-Zitationsweise einf端gen
% Leichtere Schreibweise f端r Vektoren einfuegen, damit nicht immer eine Matrix geschrieben werden muss
% Conditional CWL hilfen fuer Kommandos einfuegen, die zum Beispiel nur in Cheatsheets auftreten (z. B. \ss etc.), siehe dazu uebergelassenes Beispiel mit Conditional in eekhof.CWL